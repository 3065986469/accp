<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
	
	<title>草稿箱</title>
	<link rel="stylesheet" href="css/bootstrap.min.css" />

	</head>

	<body>
		<div class="container">
			<form>
			<div class="row">
				<div class="col-md-6">
					<input type="text" class="form-control" id="titlef" placeholder="主题" >
				</div>
		
			<div class="col-md-6">
			<input type="text" class="form-control" id="inpf" placeholder="发件人" >
			</div>
			
			</div>
			<br />
			<div class="row">
			<div class="col-md-12">
				<span>发送时间： <input type="datetime-local" id="startDate" class="form-control" style="width: 25%;display: inline-block;" value="1970-01-01T00:00" /> 至 <input type="datetime-local" class="form-control"  style="width: 25%;display: inline-block;" value="2099-01-01T00:00"   id="endDate"/></span>
				<button type="button" class="btn btn-success"  id="search">搜索</button> &nbsp;
				<button type="reset" class="btn btn-primary">清除</button> &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
					<button type="button" class="btn btn-default btn-danger"  id="delete1">彻底删除</button>
			</div>
			
			</div>
			</form>
			<br>

			<div class="row">
				<div class="table-responsive">
					<table class="table table-bordered table-striped table-hover">
						<thead>
							<tr>
								<th style="width: 20px;">
									<input type="checkbox" id="totalCbx" />
								</th>
								<th>发件人</th>
								<th>收件人</th>
								<th>主题</th>
								<th>发送时间</th>
							</tr>
						</thead>
						<tbody id="list5">
							
						</tbody>
						<tfoot>
								<tr>
									<td colspan="5">
										<ul class="pager">
											<li>
												<a href="javascript:void(0)">首页</a>
											</li>
											<li class="abled">
												<a href="javascript:void(0)">上一页</a>
											</li>
											<li class="abled">
												<a href="javascript:void(0)">下一页</a>
											</li>
											<li>
												<a href="javascript:void(0)">末页</a>
											</li>
											<li class="disabled">
												<a href="javascript:void(0)" style="margin-left: 50px;">第<b id="num"></b>页/ 共<b id="pages"></b>页  &nbsp; &nbsp;  共<b id="size"></b>条记录</a>
											</li>
										</ul>
									</td>
								</tr>
							</tfoot>
					</table>
				</div>
			</div>

		</div>
	</body>
	<script type="text/javascript" src="js/jquery-1.12.4.js"></script>
	<script type="text/javascript" src="js/bootstrap.min.js"></script>
			<script type="text/javascript" src="js/superDialog.js"></script>
	<script>	
			var pd;
			
			var topic="";
			var content="";
			var startDate=$("#startDate").val();
			var endDate=$("#endDate").val();
			
			//ajax全局设置
			  $.ajaxSetup({
			  	timeout:5000
			  });
			  $(document).ajaxError(function(){
				  contentType:"charset=UTF-8"
			  });	
		function goToPage(n,topic,content,startDate,endDate) {
			$("#totalCbx").prop("checked",false);
			$.getJSON("/emailsystems/email/drafts","pageNum="+n+"&zt="+topic+"&inboxname="+content+"&begin="+startDate+"&end="+endDate+"", function(data) {
			
				if(data.total>0){
					$("#num").text(data.pageNum);
					$("#size").text(data.total);
					$("#pages").text(data.pages);
				}else{
					$("#num").text(0);
					$("#size").text(0);
					$("#pages").text(0);
				}
				
				pd=data;
				$("#list5").empty();
				$.each(data.list, function(i, obj) {
					var $row =$row=$("<tr  data-bid='"+obj.boxId+"'><td><input type='checkbox' class='cbox' value="+obj.boxId+" /></td><td class='xzbid'>" + obj.outboxname + "</td><td class='xzbid'>" + obj.inboxname+ "</td><td class='xzbid'>" + obj.topic + "</td>"
					+"<td class='xzbid'>" + obj.createTime + "</td></tr>");
					
					 
					$("#list5").append($row);
				});
					 
			});
		}

		$(document).on("click",".xzbid",function(){
			var bid=$(this).parent().attr("data-bid");
			$.getJSON("/emailsystems/email/emailid?inboxid="+bid,function(d){
				if (d==0) {
					location.href="readEmail.html";
				}else{
					alert("系统 错误!!");
				}
			})
			
		})
		
		$(document).on("click",".cbox",function(){
			if($(".cbox:checked").length==$(".cbox").length){
				$("#totalCbx").prop("checked",true);
				
			}else{
				$("#totalCbx").prop("checked",false);
			}
		})

		$("#totalCbx").click(function(){
				if($(".cbox:checked").length<$(".cbox").length){
					$(".cbox").each(function(){
						$(this).prop("checked",true);
					})
				}else{
					$(".cbox").each(function(){
						$(this).prop("checked",false);
					})
				}
			})

		$(function() {
			goToPage(1,topic,content,startDate,endDate);
			
			$("#delete1").click(function(){
				if(confirm("确定要彻底删除吗？")==false){
					return;
				}
				
				if($(".cbox:checked").length==0){
					showAlertDialog("请选择删除项！");
					return;
				}
				var strs="";
				$(".cbox:checked").each(function(){
					strs+=$(this).val()+",";
				})
				
				$.ajax("/emailsystems/email/boxdelete",{
				type:"post",
			
				data:{
					outboxid:strs
				},
				timeout:5000,
				success:function(data){
					if(data==0){
						showAlertDialog("彻底删除成功！");
						goToPage(1,topic,content,startDate,endDate);
					}else{
						showAlertDialog("彻底删除失败！");
					}
				}
			});
			})
			


			
			$("#search").click(function(){
			 topic=$("#titlef").val();
			 content=$("#inpf").val();
			 startDate=$("#startDate").val();
			 endDate=$("#endDate").val();
			goToPage(1,topic,content,startDate,endDate);
			})
			
			//首页
			$(".pager a:eq(0)").click(function(){
				if(pd.pageNum==1){
					$(this).parents("li").addClass("disabled");
					return
				}else{
					$(this).parents("li").removeClass("disabled");
				}
				goToPage(1,topic,content,startDate,endDate);
			});
			//末页
			$(".pager a:eq(3)").click(function(){
				if(pd.pageNum==pd.lastPage){
					$(this).parents("li").addClass("disabled");
					return
				}else{
					$(this).parents("li").removeClass("disabled");
				}
				goToPage(pd.lastPage,topic,content,startDate,endDate);
			});
			
			//上一页
			$(".pager a:eq(1)").click(function(){
				$(".abled").each(function(){
						$(this).removeClass("disabled");
					})
				if(pd.hasPreviousPage){
					goToPage(pd.prePage,topic,content,startDate,endDate);
				}else{
					$(this).parents("li").addClass("disabled");
				}
			});
			
			//下一页
			$(".pager a:eq(2)").click(function(){
				$(".abled").each(function(){
						$(this).removeClass("disabled");
				})
				if(pd.hasNextPage){
					goToPage(pd.nextPage,topic,content,startDate,endDate);
				}else{
					$(this).parents("li").addClass("disabled");
				}
			});
			})
	
	</script>
</html>